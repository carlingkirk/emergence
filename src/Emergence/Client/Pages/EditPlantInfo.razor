@page "/plantinfo/edit/{Id:int}"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using Emergence.Data.Shared.Models
@using Emergence.Client.Components
@using Emergence.Data.Shared.Extensions
@attribute [Authorize]
@inherits PlantInfoComponent

<h3>Edit PlantInfo</h3>

<div class="form-group">
    <label for="common-name">Common Name</label>
    <input @bind="@PlantInfo.CommonName" type="text" class="form-control" id="common-name" />

    <label for="scientific-name">Scientific Name</label>
    <input @bind="@PlantInfo.ScientificName" type="text" class="form-control" id="scientific-name" />

    <label for="req-light-min">Minimum Light</label>

    <select @bind="@PlantInfo.Requirements.LightRequirements.MinimumLight" type="text" class="form-control" id="req-light-min">
        @foreach (var lightType in LightTypes)
        {
            <option value="@lightType">@lightType.ToFriendlyName()</option>
        }
    </select>

    <label for="req-light-max">Maximum Light</label>
    <select @bind="@PlantInfo.Requirements.LightRequirements.MaximumLight" type="text" class="form-control" id="req-light-max">
        @foreach (var lightType in LightTypes)
        {
            <option value="@lightType">@lightType.ToFriendlyName()</option>
        }
    </select>

    <label for="req-water-min">Minimum Water</label>
    <select @bind="@PlantInfo.Requirements.WaterRequirements.MinimumWater" type="text" class="form-control" id="req-water-min">
        @foreach (var waterType in WaterTypes)
        {
            <option value="@waterType">@waterType.ToFriendlyName()</option>
        }
    </select>

    <label for="req-water-max">Maximum Water</label>
    <select @bind="@PlantInfo.Requirements.WaterRequirements.MaximumWater" type="text" class="form-control" id="req-water-max">
        @foreach (var waterType in WaterTypes)
        {
            <option value="@waterType">@waterType.ToFriendlyName()</option>
        }
    </select>

    <label for="req-soil">Soil Types</label>
    @foreach (var soilType in SoilTypes)
    {
        <label for="@GetElementId("req-soil", soilType.ToString())">@soilType</label>
        <input type="checkbox" checked="@IsSoilTypeChosen(soilType)" @onclick="(() => AddSoilType(soilType))" id="@GetElementId("req-soil", "soilType")" />
    }

    <label for="req-zones-min">Minimum Zone</label>
    <input @bind="@PlantInfo.Requirements.ZoneRequirements.MinimumZone.Letter" type="text" class="form-control" id="req-zones-min" />

    <label for="req-zones-min">Maximum Zone</label>
    <input @bind="@PlantInfo.Requirements.ZoneRequirements.MaximumZone.Letter" type="text" class="form-control" id="req-zones-max" />

    <label for="req-scarification">Scarification Types</label>
    @foreach (var scarificationType in ScarificationTypes)
    {
        <label for="@GetElementId("req-soil", scarificationType.ToString())">@scarificationType</label>
        <input type="checkbox" checked="@IsScarificationTypeChosen(scarificationType)" @onclick="(() => AddScarificationType(scarificationType))" />
    }

    <label for="req-scarification">Stratification Stages</label>
    <div class="@(AnyStratificationStages() ? "d-none" : "")">
        <button class="btn btn-primary" @onclick="@(() => AddStratificationStage())">+</button>
    </div>

    @foreach (var chosenStratificationStage in ChosenStratificationStages)
    {
        StratificationStage stage = chosenStratificationStage.Value;
        var key = chosenStratificationStage.Key.ToString();

        <button class="btn btn-primary" @onclick="@(() => AddStratificationStage())">+</button>
        <button class="btn btn-primary" @onclick="@(() => RemoveStratificationStage(chosenStratificationStage.Key))">-</button>
        <div>
            <div>
                <span id="@GetElementId("req-scarification", key.ToString())">@key</span>
            </div>
            <div>
                <label for="@GetElementId("req-scarification-days", key)">Days</label>
                <input @bind="@stage.DayLength" type="text" class="form-control" id="@GetElementId("req-scarification-days", key)" />
            </div>
            <div>
                <label for="@GetElementId("req-scarification-temp-min", key)">Minimum Temperature</label>
                <input @bind="@stage.MinimumTemperature" type="text" class="form-control" id="@GetElementId("req-scarification-temp-min", key)" />
            </div>
            <div>
                <label for="@GetElementId("req-scarification-temp-max", key)">Maximum Temperature</label>
                <input @bind="@stage.MaximumTemperature" type="text" class="form-control" id="@GetElementId("req-scarification-temp-max", key)" />
            </div>
        </div>
    }

    <label for="req-seedstorage">Refrigerate seed?</label>
    <input type="checkbox" @bind="@PlantInfo.Requirements.SeedStorageRequirements.Refrigerate" />

    <label for="bloom-min">Bloom Start</label>
    <select @bind="@PlantInfo.BloomTime.MinimumBloomTime" type="text" class="form-control" id="bloom-min">
        @foreach (var month in Months)
        {
            <option value="@month">@month.ToFriendlyName()</option>
        }
    </select>

    <label for="bloom-max">Bloom End</label>
    <select @bind="@PlantInfo.BloomTime.MaximumBloomTime" type="text" class="form-control" id="bloom-max">
        @foreach (var month in Months)
        {
            <option value="@month">@month.ToFriendlyName()</option>
        }
    </select>

    <label for="height-min">Minimum Height</label>
    <input @bind="@PlantInfo.Height.MinimumHeight" type="text" class="form-control" id="height-min" />

    <label for="height-max">Maximum Height</label>
    <input @bind="@PlantInfo.Height.MaximumHeight" type="text" class="form-control" id="height-max" />

    <select @bind="@PlantInfo.Height.Unit" type="text" class="form-control" id="bloom-unit">
        @foreach (var unit in Units)
        {
            <option value="@unit">@unit.ToFriendlyName()</option>
        }
    </select>

    <label for="spread-min">Minimum Spread</label>
    <input @bind="@PlantInfo.Spread.MinimumSpread" type="text" class="form-control" id="spread-min" />

    <label for="spread-max">Maximum Spread</label>
    <input @bind="@PlantInfo.Spread.MaximumSpread" type="text" class="form-control" id="spread-max" />

    <select @bind="@PlantInfo.Spread.Unit" type="text" class="form-control" id="spread-unit">
        @foreach (var unit in Units)
        {
            <option value="@unit">@unit.ToFriendlyName()</option>
        }
    </select>

</div>

@code {
    protected string GetElementId(string element, string id)
    {
        return element + "-" + id;
    }
}
